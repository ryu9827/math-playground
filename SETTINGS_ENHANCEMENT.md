# è®¾ç½®åŠŸèƒ½å¢å¼ºæ›´æ–°

## æ›´æ–°æ—¥æœŸ

2025 å¹´ 10 æœˆ 5 æ—¥

## æ›´æ–°å†…å®¹

### 1. éŸ³æ•ˆå¼€å…³ ğŸ”ŠğŸ”‡

#### åŠŸèƒ½æè¿°

- åœ¨è®¾ç½®ç•Œé¢æ·»åŠ éŸ³æ•ˆå¼€å…³æŒ‰é’®
- å¯ä»¥å¯ç”¨/ç¦ç”¨ç­”å¯¹é¢˜ç›®æ—¶çš„åº†ç¥éŸ³æ•ˆ
- è®¾ç½®å®æ—¶ä¿å­˜åˆ° localStorage
- é»˜è®¤å¯ç”¨éŸ³æ•ˆ

#### æŠ€æœ¯å®ç°

**Redux State æ›´æ–°**

```typescript
export interface SettingsState {
	soundEnabled: boolean // æ–°å¢
}
```

**è®¾ç½®ç•Œé¢**

```tsx
<button className={`toggle-btn ${soundEnabled ? 'active' : ''}`}>
	<span className='toggle-icon'>{soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡'}</span>
	<span className='toggle-text'>{soundEnabled ? 'å¯ç”¨éŸ³æ•ˆ' : 'ç¦ç”¨éŸ³æ•ˆ'}</span>
</button>
```

**åŠ¨ç”»ç»„ä»¶é›†æˆ**

```typescript
// CelebrationAnimation.tsx
const { soundEnabled } = useSelector((state: RootState) => state.settings)

if (soundEnabled) {
	soundEffects.playRandomCelebration()
}
```

#### æ ·å¼ç‰¹æ€§

- åœ†è§’æŒ‰é’®è®¾è®¡
- å¯ç”¨æ—¶æ˜¾ç¤ºç´«è‰²é«˜äº®
- æ‚¬åœæ—¶æŒ‰é’®ä¸Šç§»åŠ¨ç”»
- å›¾æ ‡+æ–‡å­—ç»„åˆæ˜¾ç¤º

---

### 2. æ•°å­—èŒƒå›´ä¸‹é™è®¾ç½® ğŸ”¢

#### åŠŸèƒ½æè¿°

- æ·»åŠ æ•°å­—èŒƒå›´çš„ä¸‹é™è®¾ç½®
- ä¸ä¸Šé™ä¸€èµ·æ§åˆ¶é¢˜ç›®ç”Ÿæˆçš„æ•°å­—èŒƒå›´
- è®¾ç½®ä¿å­˜åˆ° localStorage
- é»˜è®¤ä¸‹é™ä¸º 1

#### æŠ€æœ¯å®ç°

**Redux State æ›´æ–°**

```typescript
export interface SettingsState {
	minNumber: number // æ–°å¢
	maxNumber: number // å·²æœ‰
}
```

**é¢˜ç›®ç”Ÿæˆå™¨æ›´æ–°**

```typescript
// æ›´æ–°å‡½æ•°ç­¾å
export const generateNewQuestion = (
	min: number,     // æ–°å¢å‚æ•°
	max: number,
	operationType: OperationType,
	wrongQuestions: WrongQuestion[]
): Question
```

**å„è¿ç®—ç±»å‹çš„èŒƒå›´æ§åˆ¶**

1. **åŠ æ³•**ï¼šç¡®ä¿ `num1 + num2` åœ¨ `[min, max]` èŒƒå›´å†…
2. **å‡æ³•**ï¼šç¡®ä¿ç»“æœåœ¨ `[min, max]` èŒƒå›´å†…
3. **ä¹˜æ³•**ï¼šç¡®ä¿ `num1 Ã— num2` åœ¨ `[min, max]` èŒƒå›´å†…ï¼Œå¦‚æœç»“æœå°äº min åˆ™é‡æ–°è°ƒæ•´
4. **é™¤æ³•**ï¼šç¡®ä¿å•†åœ¨ `[min, max]` èŒƒå›´å†…

#### è®¾ç½®ç•Œé¢å¸ƒå±€

```
[ä¸‹é™è¾“å…¥æ¡†]  [ä¸Šé™è¾“å…¥æ¡†]
  (1-100)       (1-100)
```

---

### 3. LocalStorage æŒä¹…åŒ– ğŸ’¾

#### å®ç°æ–¹å¼

**ä¿å­˜æ—¶æœº**

- æ¯æ¬¡ä¿®æ”¹ä»»ä½•è®¾ç½®æ—¶è‡ªåŠ¨ä¿å­˜
- ä¸éœ€è¦æ‰‹åŠ¨è§¦å‘ä¿å­˜

**å­˜å‚¨é”®å**

```typescript
'math-playground-settings'
```

**å­˜å‚¨å†…å®¹**

```json
{
	"language": "zh",
	"minNumber": 1,
	"maxNumber": 20,
	"soundEnabled": true
}
```

**åŠ è½½é€»è¾‘**

```typescript
const loadSettings = (): SettingsState => {
	try {
		const stored = localStorage.getItem('math-playground-settings')
		if (stored) {
			const settings = JSON.parse(stored)
			return {
				language: settings.language || 'zh',
				minNumber: settings.minNumber || 1,
				maxNumber: settings.maxNumber || 20,
				soundEnabled:
					settings.soundEnabled !== undefined ? settings.soundEnabled : true,
			}
		}
	} catch (error) {
		console.error('Failed to load settings')
	}
	// è¿”å›é»˜è®¤å€¼
}
```

---

## æ–‡ä»¶å˜æ›´æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **src/store/settingsSlice.ts**

   - æ·»åŠ  `minNumber` å’Œ `soundEnabled` åˆ° state
   - æ·»åŠ  `setMinNumber` å’Œ `setSoundEnabled` actions
   - æ·»åŠ  `loadSettings()` å’Œ `saveSettings()` å‡½æ•°
   - åˆå§‹åŒ–æ—¶ä» localStorage åŠ è½½è®¾ç½®
   - æ¯æ¬¡ä¿®æ”¹æ—¶è‡ªåŠ¨ä¿å­˜åˆ° localStorage

2. **src/components/SettingsModal.tsx**

   - å¯¼å…¥æ–°çš„ actions: `setMinNumber`, `setSoundEnabled`
   - æ·»åŠ ä¸‹é™è¾“å…¥æ¡†
   - æ·»åŠ éŸ³æ•ˆå¼€å…³æŒ‰é’®
   - ä¿å­˜æ—¶ç¡®ä¿ä¸‹é™ä¸å¤§äºä¸Šé™

3. **src/styles/SettingsModal.scss**

   - æ·»åŠ  `.sound-toggle` æ ·å¼
   - æ·»åŠ  `.toggle-btn` æ ·å¼ï¼ˆåŒ…æ‹¬ active çŠ¶æ€ï¼‰
   - æ›´æ–° `.input-group` å®½åº¦ä»¥å®¹çº³ä¸¤ä¸ªè¾“å…¥æ¡†
   - æ·»åŠ  `.range-inputs` çš„ flex-wrap æ”¯æŒ

4. **src/components/CelebrationAnimation.tsx**

   - å¯¼å…¥ Redux hooks
   - ä» state è¯»å– `soundEnabled`
   - æ ¹æ®è®¾ç½®æ¡ä»¶æ€§æ’­æ”¾éŸ³æ•ˆ

5. **src/components/Question.tsx**

   - ä» state è¯»å– `minNumber`
   - ä¼ é€’ `minNumber` ç»™ `generateNewQuestion()`
   - æ›´æ–°ä¾èµ–æ•°ç»„åŒ…å« `minNumber`

6. **src/utils/questionGenerator.ts**

   - æ›´æ–°å‡½æ•°ç­¾åæ·»åŠ  `min` å‚æ•°
   - é‡å†™åŠ æ³•ç”Ÿæˆé€»è¾‘æ”¯æŒä¸‹é™
   - é‡å†™å‡æ³•ç”Ÿæˆé€»è¾‘æ”¯æŒä¸‹é™
   - é‡å†™ä¹˜æ³•ç”Ÿæˆé€»è¾‘æ”¯æŒä¸‹é™
   - é‡å†™é™¤æ³•ç”Ÿæˆé€»è¾‘æ”¯æŒä¸‹é™

7. **src/utils/i18n.ts**
   - æ·»åŠ  `minNumber` ç¿»è¯‘
   - æ·»åŠ  `soundSettings` ç¿»è¯‘
   - æ·»åŠ  `soundEnabled` ç¿»è¯‘
   - æ·»åŠ  `soundDisabled` ç¿»è¯‘
   - æ·»åŠ  `soundHint` ç¿»è¯‘

---

## ä½¿ç”¨æŒ‡å—

### è®¾ç½®éŸ³æ•ˆå¼€å…³

1. ç‚¹å‡»å¯¼èˆªæ å³ä¾§çš„ âš™ï¸ é½¿è½®å›¾æ ‡
2. åœ¨"éŸ³æ•ˆè®¾ç½®"åŒºåŸŸæ‰¾åˆ°éŸ³æ•ˆå¼€å…³
3. ç‚¹å‡»æŒ‰é’®åˆ‡æ¢çŠ¶æ€ï¼š
   - ğŸ”Š å¯ç”¨éŸ³æ•ˆï¼ˆç´«è‰²é«˜äº®ï¼‰
   - ğŸ”‡ ç¦ç”¨éŸ³æ•ˆï¼ˆç°è‰²ï¼‰
4. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
5. è®¾ç½®ç«‹å³ç”Ÿæ•ˆï¼Œä¸‹æ¬¡æ‰“å¼€ä¼šè‡ªåŠ¨è®°ä½

### è®¾ç½®æ•°å­—èŒƒå›´

1. ç‚¹å‡»å¯¼èˆªæ å³ä¾§çš„ âš™ï¸ é½¿è½®å›¾æ ‡
2. åœ¨"æ•°å­—èŒƒå›´è®¾ç½®"åŒºåŸŸï¼š
   - å·¦ä¾§è¾“å…¥æ¡†ï¼šè®¾ç½®ä¸‹é™ï¼ˆ1-100ï¼‰
   - å³ä¾§è¾“å…¥æ¡†ï¼šè®¾ç½®ä¸Šé™ï¼ˆ1-100ï¼‰
3. ä¿å­˜æ—¶ç³»ç»Ÿè‡ªåŠ¨ç¡®ä¿ä¸‹é™ â‰¤ ä¸Šé™
4. ç‚¹å‡»"ä¿å­˜"æŒ‰é’®
5. æ–°é¢˜ç›®å°†åœ¨è®¾å®šèŒƒå›´å†…ç”Ÿæˆ

### ç¤ºä¾‹åœºæ™¯

**åˆå­¦è€…**

- ä¸‹é™ï¼š1
- ä¸Šé™ï¼š10
- éŸ³æ•ˆï¼šå¯ç”¨
  â†’ ç”Ÿæˆ 1-10 èŒƒå›´å†…çš„ç®€å•é¢˜ç›®ï¼Œå¸¦æœ‰åº†ç¥éŸ³æ•ˆ

**è¿›é˜¶ç»ƒä¹ **

- ä¸‹é™ï¼š10
- ä¸Šé™ï¼š50
- éŸ³æ•ˆï¼šå¯ç”¨
  â†’ ç”Ÿæˆ 10-50 èŒƒå›´å†…çš„ä¸­ç­‰éš¾åº¦é¢˜ç›®

**ä¸“æ³¨æ¨¡å¼**

- ä¸‹é™ï¼š1
- ä¸Šé™ï¼š100
- éŸ³æ•ˆï¼šç¦ç”¨
  â†’ ç”Ÿæˆå®Œæ•´èŒƒå›´é¢˜ç›®ï¼Œé™éŸ³æ¨¡å¼ä¸æ‰“æ‰°

---

## æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½èŒƒå›´æ§åˆ¶

```typescript
// ç¡®ä¿ä¸‹é™ä¸å¤§äºä¸Šé™
const finalMin = Math.max(1, Math.min(localMin, localMax))
const finalMax = Math.max(finalMin, localMax)
```

### 2. ä¼˜é›…çš„çŠ¶æ€åŒæ­¥

- Redux ç®¡ç†å…¨å±€çŠ¶æ€
- localStorage æŒä¹…åŒ–å­˜å‚¨
- ç»„ä»¶è‡ªåŠ¨å“åº”å˜åŒ–

### 3. ç”¨æˆ·å‹å¥½çš„äº¤äº’

- å®æ—¶è§†è§‰åé¦ˆï¼ˆæŒ‰é’®é«˜äº®ã€åŠ¨ç”»ï¼‰
- è‡ªåŠ¨ä¿å­˜è®¾ç½®
- é˜²å‘†è®¾è®¡ï¼ˆä¸‹é™è‡ªåŠ¨ä¿®æ­£ï¼‰

### 4. å‘åå…¼å®¹

```typescript
// å¦‚æœ localStorage ä¸­æ²¡æœ‰æ–°å­—æ®µï¼Œä½¿ç”¨é»˜è®¤å€¼
soundEnabled: settings.soundEnabled !== undefined ? settings.soundEnabled : true
```

---

## æ€§èƒ½ä¼˜åŒ–

1. **æŒ‰éœ€æ’­æ”¾éŸ³æ•ˆ**

   - åªåœ¨å¯ç”¨æ—¶æ’­æ”¾
   - é¿å…ä¸å¿…è¦çš„éŸ³é¢‘å¤„ç†

2. **localStorage ä¼˜åŒ–**

   - åªåœ¨è®¾ç½®æ”¹å˜æ—¶å†™å…¥
   - å¯åŠ¨æ—¶ä¸€æ¬¡æ€§åŠ è½½
   - é”™è¯¯å¤„ç†é˜²æ­¢å´©æºƒ

3. **é¢˜ç›®ç”Ÿæˆä¼˜åŒ–**
   - æ ¹æ®èŒƒå›´æ™ºèƒ½è°ƒæ•´ç®—æ³•
   - é¿å…æ— æ•ˆå¾ªç¯

---

## åç»­å¯èƒ½çš„æ”¹è¿›

1. **éŸ³æ•ˆå¢å¼º**

   - æ·»åŠ éŸ³é‡æ§åˆ¶æ»‘å—
   - æ”¯æŒä¸åŒéŸ³æ•ˆä¸»é¢˜
   - é”™è¯¯æç¤ºéŸ³

2. **èŒƒå›´é¢„è®¾**

   - å¿«é€Ÿé€‰æ‹©å¸¸ç”¨èŒƒå›´ï¼ˆ1-10, 1-20, 1-50, 1-100ï¼‰
   - ä¿å­˜è‡ªå®šä¹‰é¢„è®¾

3. **é«˜çº§è®¾ç½®**
   - å•ç‹¬æ§åˆ¶æ¯ç§è¿ç®—çš„èŒƒå›´
   - è¿ç®—éš¾åº¦åˆ†çº§
   - é¢˜ç›®ç”Ÿæˆç­–ç•¥é€‰æ‹©

---

## æ€»ç»“

æœ¬æ¬¡æ›´æ–°ä¸ºç”¨æˆ·æä¾›äº†æ›´çµæ´»çš„è®¾ç½®é€‰é¡¹ï¼š

âœ… **éŸ³æ•ˆæ§åˆ¶**ï¼šå¯ä»¥æ ¹æ®ç¯å¢ƒé€‰æ‹©å¼€å¯æˆ–å…³é—­éŸ³æ•ˆ  
âœ… **èŒƒå›´æ§åˆ¶**ï¼šç²¾ç¡®æ§åˆ¶é¢˜ç›®éš¾åº¦ï¼Œé€‚åº”ä¸åŒå­¦ä¹ é˜¶æ®µ  
âœ… **æŒä¹…åŒ–å­˜å‚¨**ï¼šè®¾ç½®æ°¸ä¹…ä¿å­˜ï¼Œæ— éœ€é‡å¤é…ç½®  
âœ… **æ™ºèƒ½ä¿æŠ¤**ï¼šè‡ªåŠ¨ä¿®æ­£ä¸åˆç†çš„è®¾ç½®å€¼

è¿™äº›åŠŸèƒ½è®©æ•°å­¦ç»ƒä¹ åº”ç”¨æ›´åŠ çµæ´»å’Œäººæ€§åŒ–ï¼ğŸ‰
