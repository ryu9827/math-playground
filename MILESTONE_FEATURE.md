# 里程碑奖励系统

## 功能概述

实现了一个多次触发的大型奖励系统，每完成设定目标数量（如 20 题）的倍数时，都会显示特殊的庆祝动画。**使用与原始目标达成动画一致的全屏风格，包括飘动的小动物、烟花和彩带效果。**

## 主要特性

### 1. 多次触发

- 不是只在第一次达成目标时触发
- 每达到目标的倍数（20 题、40 题、60 题...）都会触发
- 每天可以触发无限次

### 2. 随机样式

每次触发时，以下元素都是随机的：

#### 奖杯样式（12 种）

- 🏆 金色奖杯
- 🥇 金牌
- 🎖️ 红色勋章
- 👑 皇冠
- ⭐ 星星
- 💎 钻石
- 🌟 闪亮星星
- ✨ 火花
- 🎯 靶心
- 🔥 火焰
- 💪 力量
- 🚀 火箭

#### 祝贺文字（各 10 种）

**中文：**

- 太棒了！、真厉害！、好样的！、了不起！等

**英文：**

- Amazing!、Fantastic!、Excellent!、Outstanding!等

### 3. 全屏视觉效果（与原始目标动画一致）

- 🌈 **全屏渐变背景**（蓝紫色到黑色）+ 模糊效果
- 🐰 **30 个随机飘动的小动物**：🐰🦊🐱🐶🐼🐨🐹🦄🐻🦁🐯🐸 等
  - 从屏幕各处出现
  - 上下跳跃移动
  - 旋转飞舞
  - 自动淡入淡出
- 🎆 **50 个烟花爆炸效果**
  - 分布在全屏
  - 12 个方向的粒子爆炸
  - 不断循环播放
- 🎊 **100 条彩带飘落**
  - 6 种随机颜色
  - 从上往下飘落
  - 旋转飘舞
  - 无限循环

### 4. 音效

- 播放随机庆祝音效（与普通答题庆祝一致）
- 使用现有的 `soundEffects.playRandomCelebration()`

### 5. 信息显示

- 大型奖杯图标（随机选择，带旋转动画）
- 随机祝贺语（大标题，金色发光）
- 显示已完成的题目数量（带彩色高亮）
- 显示是第几次达成目标
- 三颗星星装饰

### 6. 自动关闭

- 20 秒后自动关闭（与原始目标动画一致）
- 用户可以点击背景提前关闭

## 技术实现

### 1. 数据结构更新 (`dailyStats.ts`)

```typescript
interface DailyStats {
	date: string
	questionsAnswered: number
	goalAchieved: boolean
	milestonesAchieved: number[] // 新增：记录已触发的里程碑
}
```

### 2. 核心函数

#### `checkMilestone(dailyGoal: number): number | null`

- 检查是否达到新的里程碑
- 返回新达到的里程碑数值（如 20、40、60）
- 如果没有新里程碑则返回 null
- 自动记录到 localStorage，避免重复触发

#### `getMilestoneCount(milestone: number, dailyGoal: number): number`

- 计算这是第几次达成目标
- 例如：milestone=40, dailyGoal=20，返回 2

### 3. 组件

#### `MilestoneReward.tsx`

- **全屏覆盖层**（与 GoalAchievedAnimation 一致）
- **不是弹窗**，而是占据整个屏幕
- 30 个飘动的小动物
- 50 个烟花爆炸
- 100 条彩带飘落
- 随机奖杯和祝贺语
- 20 秒后自动关闭
- 支持中英文切换
- 响应式设计，移动端友好

### 4. 样式 (`MilestoneReward.scss`)

- **完全继承 GoalAchievedAnimation 的样式**
- 全屏 overlay（z-index: 99999）
- 渐变背景 + 模糊效果
- 小动物、烟花、彩带动画
- 中央内容区域
- 金色发光文字效果
- 移动端适配

### 5. 与原始目标动画的区别

虽然视觉风格完全一致，但内容有所不同：

| 特性     | GoalAchievedAnimation | MilestoneReward    |
| -------- | --------------------- | ------------------ |
| 触发时机 | 第一次达成每日目标    | 每次达成目标倍数   |
| 奖杯     | 固定 🏆               | 随机 12 种         |
| 主标题   | "今日目标达成"        | 随机祝贺语         |
| 副标题   | 固定文字              | 显示具体题数和次数 |
| 触发次数 | 每天 1 次             | 每天无限次         |

## 使用流程

1. 用户答对一题
2. `Question.tsx` 调用 `incrementQuestionsAnswered()`
3. 检查 `checkMilestone(dailyGoal)`
4. 如果返回里程碑数值，延迟 2 秒触发
5. 显示 `MilestoneReward` 组件
6. 用户点击"继续加油"按钮关闭

## 数据持久化

- 使用 localStorage 存储已触发的里程碑
- 每天午夜自动重置
- 向后兼容旧版本数据

## 示例场景

假设每日目标设置为 20 题：

1. **完成 20 题**

   - 触发里程碑奖励
   - 显示："已完成 20 题"
   - 显示："第 1 次达成目标！"
   - 随机奖杯：可能是 🏆

2. **完成 40 题**

   - 再次触发里程碑奖励
   - 显示："已完成 40 题"
   - 显示："第 2 次达成目标！"
   - 随机奖杯：可能是 💎

3. **完成 60 题**
   - 第三次触发
   - 显示："已完成 60 题"
   - 显示："第 3 次达成目标！"
   - 随机奖杯：可能是 🚀

## 文件清单

### 新增文件

- `src/components/MilestoneReward.tsx` - 里程碑奖励组件
- `src/styles/MilestoneReward.scss` - 里程碑奖励样式

### 修改文件

- `src/utils/dailyStats.ts` - 添加里程碑追踪功能
- `src/components/Question.tsx` - 集成里程碑检查
- `src/App.tsx` - 添加里程碑奖励组件
- `src/components/DailyStats.tsx` - 修复跨天重置问题

## 注意事项

1. 每个里程碑只触发一次（当天）
2. 新的一天会自动重置所有里程碑记录
3. 只有答对题目才会检查里程碑
4. 答错题目不影响计数，但不触发奖励
5. 里程碑动画延迟 2 秒，让普通庆祝动画先播放

## 未来改进建议

1. 添加更多奖杯样式
2. 添加用户自定义奖励内容
3. 记录历史最高里程碑
4. 添加分享功能
5. 添加成就系统
